<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--- common --->
    <!-- load -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/gridlex/2.3.1/gridlex.min.css">
    <script
            src="//code.jquery.com/jquery-2.2.4.min.js"
            integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
            crossorigin="anonymous">
    </script>
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="common.css">
    <script defer src="common.js"></script>

    <!-- meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="UTF-8" />
    <meta property="og:type"   content="website" />
    <meta name="msapplication-TileColor" content="#337AB7">

    <!-- GA
    <script async src="//www.googletagmanager.com/gtag/js?id=xxx"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'xxx');
    </script>
     -->

    <!--- unique --->
    <title>payment</title>
    <meta property="og:url"    content="xxx" />
    <meta property="og:site_name"  content="xxx" />
    <meta property="og:description"  content="xxx" />
    <meta name="description" content="xxx">


    <link rel="stylesheet" href="magnific-popup.css">
    <script src="magnific-popup.js"></script>

  </head>
  <body id="body">
    <div class="grid col-12" style="margin: 3rem 0">
      <div class="grid-center col-6">
        <div id="omise" class="grid col-12 popup-image raised" style="line-height: 1.3rem;cursor: pointer;max-width: 8rem;height: 3rem" href="#omise-popup">
          <div class="col-12-middle" style="text-align: center">
            クレジットカードで支払う
          </div>
        </div>
      </div>

      <div id="omise-popup" class="white-popup mfp-hide grid col-12" style="background: white;padding: .5rem">
        <form id="form" class="grid col-12" action="thanks" method="post">
          <script src="https://cdn2.omise.co/omise.js"></script>
          <div class="col-12" style="text-align: center">
            <h2 style="line-height: 2rem">コングレス登録費</h1>
          </div>

          <div class="col-10_sm-12" style="margin-top: 1rem;font-size: .8rem;color: red;margin: auto">
            以下の項目をご入力ください。
          </div>

          <div class="grid-middle col-10_sm-12" style="margin: 1rem auto">
            <div class="grid col-12">
              <div class="grid col-12">
                <div class="col-3_sm-12">
                  <label for="amount">金額</label>
                </div>
                <div class="col-9_sm-12">
                  <input id="amount" name="amount" type="number" min="100" max="100000" value="500" class="validate" style="width:100%" required>
                </div>
              </div>

              <div class="grid col-12" style="margin-top: .5rem">
                <div class="col-3_sm-12-middle">
                  <span class="required-item">お名前</span>
                </div>
                <div class="grid col-7_sm-12">
                  <div class="grid col-6_sm-12 margin-top-0-5-mobile">
                    <div class="col-3-middle white-space-nowrap">
                      <span class="">姓　</span>
                    </div>
                    <div class="col-8_xs-9-middle grid">
                      <input class="col-12" placeholder="入力してください" type="text" value="あああ" name="last_name" id="last_name">
                    </div>
                  </div>
                  <div class="grid col-6_sm-12 margin-top-0-5-mobile">
                    <div class="col-3-middle white-space-nowrap">
                      <span class="">名　</span>
                    </div>
                    <div class="col-8_xs-9-middle grid">
                      <input class="col-12" placeholder="入力してください" type="text" value="太郎" name="first_name" id="first_name">
                    </div>
                  </div>
                </div>
              </div>

              <div class="grid col-12" style="margin-top: .5rem">
                <div class="col-3_sm-12-middle">
                  <span class="required-item">メール</span>
                </div>
                <div class="grid col-7_sm-12">
                  <input class="col-12" placeholder="入力してください" type="text" value="aaa" name="email" id="email">
                </div>
              </div>

              <div class="grid col-12" style="margin-top: .5rem">
                <div class="col-3_sm-12-middle">
                  <span class="required-item">備考</span>
                </div>
                <div class="grid col-7_sm-12">
                  <textarea class="col-12 padding-0-5" rows="4" cols="40" name="comment" id="comment" style="line-height: 1.5rem"></textarea>
                </div>
              </div>

              <div class="grid-center col-12" style="margin: .5rem auto">
                <input type="hidden" name="description" value="即時決済" />
                <button class=" omise-button-attach raised">
                  決済する
                </button>
              </div>
            </div>
          </div>
          <button type="submit" class="omise-button raised display-none" style="display: none">
          </button>
        </form>
      </div>
    </div>
    <footer>
      <div>
          <a href="#" target="_blank">
            World Saxophone Festival KURASHIKI 2021
          </a>
      </div>
    </footer>
    <link rel="stylesheet" href="payment.css">
  </body>

  <script>
    $(function(){
          $('.popup-image').magnificPopup({
          type: 'inline',
          removalDelay: 200,
          preloader: true
      });
    });
    OmiseCard.configure({
      publicKey: "pkey_test_5h1nzz1w8wmwtfd9xxp",
      currency: "jpy",
      //image:"https://enc.piano.or.jp/images/enc.png",
      frameLabel: "WSC KURASHIKI 2021",
      frameDescription: "仮登録費",
      submitLabel: "決済実行",
      locale: "ja",
      amount: $("#amount").val()
    });
    OmiseCard.configureButton('.omise-button');
    OmiseCard.attach();
    $(document).on("keyup", function() {
      console.log(checkFormInputDone());
      if(checkFormInputDone()){
        $("#submit").css('background-color','#26a69b');
        $("#submit").attr('type','submit');
      }else{
        $("#submit").css('background-color','#FFFFFF');
        $("#submit").attr('type','button');
      }
    });
    $(".omise-button-attach").click(function(){
      if (parseInt($('#amount').val()) >= 100 || parseInt($('#amount').val()) <= 100000){
        OmiseCard.configureButton('.omise-button',{
           amount: $("#amount").val()
         });
        OmiseCard.attach();
      }
      setTimeout(function(){
        //$(".omise-button").removeClass("omise-button-attach");
        $('.omise-button')[0].click();
      },500);
    });
    $('#mag_CLOSE').click(function(e) {
      e.preventDefault();
      if (window.parent == window.top) {
        window.parent.$.magnificPopup.close();
      }
    });

    function checkFormInputDone() {
      if (!($('#last_name').val())){
        return false;
      }
      else if (!($('#first_name').val())) {
        return false;
      }
      else if (!($('#email').val())) {
        return false;
      }
      else if(!$('#email').val().match(/^([a-zA-Z0-9])+([a-zA-Z0-9\._-])*@([a-zA-Z0-9_-])+([a-zA-Z0-9\._-]+)+$/)){
        return false;
      }
      else if (!($('#amount').val())) {
        return false;
      }
      else if (parseInt($('#amount').val()) < 100 || parseInt($('#amount').val()) > 100000) {
        return false;
      }
      else {
        return true;
      }
    }

    $('#form').submit(function(){
      return false;
    });
  </script>
</html>
